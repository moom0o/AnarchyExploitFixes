package me.moomoo.anarchyexploitfixes.patches;

import me.moomoo.anarchyexploitfixes.Main;
import org.bukkit.ChatColor;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.entity.Boat;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerMoveEvent;

public class Boats implements Listener {
    private final Main plugin;

    public Boats(Main plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    private void onMove(PlayerMoveEvent evt) {
        FileConfiguration config = plugin.getConfig();
        if (config.getBoolean("BoatflyPatch")) {
            if (evt.getPlayer().isInsideVehicle()) {
                int x = evt.getPlayer().getLocation().getBlockX();
                int y = evt.getPlayer().getLocation().getBlockY();
                int z = evt.getPlayer().getLocation().getBlockZ();

                Location from = evt.getFrom();
                Location to = evt.getTo();
                double distY = to.getY() - from.getY();

                double distX = to.getX() - from.getX();
                double distZ = to.getZ() - from.getZ();
                double finalValue = Math.hypot(distX, distZ);

                // ik its a mess idgaf
                if ((evt.getPlayer().getWorld().getBlockAt(x, y - 1, z).getType() == Material.AIR) && evt.getPlayer().getWorld().getBlockAt(x, y - 2, z).getType() == Material.AIR && evt.getPlayer().getWorld().getBlockAt(x, y - 3, z).getType() == Material.AIR) {
                    if (distY != -0.439999999105936) { // Minecraft has an exact Y distance number for boats
                        if (evt.getPlayer().getVehicle() instanceof Boat) {
                            if (finalValue > 0.50 || distY > 0.0) {
                                evt.getPlayer().getVehicle().remove();
                                if (config.getBoolean("BoatflyMessage")) {
                                    if (evt.getPlayer().getLocale().startsWith("es")) {
                                        evt.getPlayer().sendMessage(ChatColor.GOLD + "Bote volar Deshabilitado debido a un exploit >:)");
                                    } else {
                                        evt.getPlayer().sendMessage(ChatColor.GOLD + "Boatfly disabled due to an exploit >:) If you aren't boat flying, boats on land are a little buggy.");
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
