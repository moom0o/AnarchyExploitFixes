package me.moomoo.anarchyexploitfixes.patches;

import me.moomoo.anarchyexploitfixes.Main;
import org.bukkit.ChatColor;
import org.bukkit.Chunk;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.block.Container;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.block.BlockPlaceEvent;

public class ChunkBan implements Listener {
    private final Main plugin;

    public ChunkBan(Main plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    private void onBlockPlace(BlockPlaceEvent evt) {
        FileConfiguration config = plugin.getConfig();

        if (config.getBoolean("PreventChunkBan")) {
            Chunk c = evt.getBlock().getChunk();
            Block b = evt.getBlock();

            if (b.getType() == Material.ENCHANTMENT_TABLE) {
                if (plugin.checkChunk(Material.ENCHANTMENT_TABLE, c) > config.getInt("MaxEnchantmentTablePerChunk")) {
                    if (evt.getPlayer().getLocale().startsWith("es")) {
                        evt.getPlayer().sendMessage(ChatColor.GOLD + "Solo se le permite colocar una peque単a cantidad de mesas de encantamiento / cofres de ender debido al lag.");
                    } else {
                        evt.getPlayer().sendMessage(ChatColor.GOLD + "You are only allowed to place a small amount of enchantment tables/end chests due to lag.");
                    }
                    evt.setCancelled(true);
                }
            } else {
                if (b.getType() == Material.ENDER_CHEST) {
                    if (plugin.checkChunk(Material.ENDER_CHEST, c) > config.getInt("MaxEnderchestPerChunk")) {
                        if (evt.getPlayer().getLocale().startsWith("es")) {
                            evt.getPlayer().sendMessage(ChatColor.GOLD + "Solo se le permite colocar una peque単a cantidad de mesas de encantamiento / cofres de ender debido al lag.");
                        } else {
                            evt.getPlayer().sendMessage(ChatColor.GOLD + "You are only allowed to place a small amount of enchantment tables/end chests due to lag.");
                        }
                        evt.setCancelled(true);
                    }
                }
                if (b.getState() instanceof Container) {
                    if (plugin.checkChunk(b.getType(), c) > config.getInt("MaxContainerPerChunk")) {
                        if (evt.getPlayer().getLocale().startsWith("es")) {
                            evt.getPlayer().sendMessage(ChatColor.GOLD + "Solo se le permite colocar una peque単a cantidad de almacenamiento containers debido al lag.");
                        } else {
                            evt.getPlayer().sendMessage(ChatColor.GOLD + "You are only allowed to place a small amount of storage containers due to lag.");
                        }
                        evt.setCancelled(true);
                    }
                } else {
                    if (b.getType() == Material.WALL_SIGN || b.getType() == Material.SIGN_POST) {
                        if (plugin.checkChunk(b.getType(), c) > config.getInt("MaxSignPerChunk")) {
                            if (evt.getPlayer().getLocale().startsWith("es")) {
                                evt.getPlayer().sendMessage(ChatColor.GOLD + "Solo se le permite colocar una peque単a cantidad de letreros debido al lag");
                            } else {
                                evt.getPlayer().sendMessage(ChatColor.GOLD + "You are only allowed to place a small amount of signs due to lag.");
                            }
                            evt.setCancelled(true);
                        }
                    }
                }
            }
        }
    }
}
