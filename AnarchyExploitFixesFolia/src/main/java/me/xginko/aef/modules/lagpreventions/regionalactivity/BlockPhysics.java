package me.xginko.aef.modules.lagpreventions.regionalactivity;

import com.cryptomorin.xseries.XMaterial;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.block.BlockPhysicsEvent;

import java.util.Map;

public class BlockPhysics extends RegionalBlockActivityModule {

    public BlockPhysics() {
        super(
                "block-physics",
                false,
                true,
                512000,
                1500.0,
                18000,
                20000,
                10.0,
                120.0,
                Map.of( XMaterial.WATER, 256000,
                        XMaterial.LAVA, 256000),
                """
                Limits block physics within a configurable radius and timeframe\s
                to help reduce lag by cancelling burst activity hotspots.\s
                \s
                Note:\s
                \s
                The event used for this check (BlockPhysicsEvent) is a high frequency event,\s
                it may be called thousands of times per a second on a busy server.\s
                Where possible the event may also only be called for the "root" block of\s
                physics updates in order to limit event spam.\s
                Physics updates that cause other blocks to change their state may not result\s
                in an event for each of those blocks (usually adjacent)."""
        );
    }

    @EventHandler(priority = EventPriority.HIGHEST, ignoreCancelled = true)
    private void onBlockPhysics(BlockPhysicsEvent event) {
        if (shouldCancelBlockEvent(event)) {
            event.setCancelled(true);
        }
    }
}
