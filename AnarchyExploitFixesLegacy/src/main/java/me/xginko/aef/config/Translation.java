package me.xginko.aef.config;

import io.github.thatsmusic99.configurationmaster.api.ConfigFile;
import me.xginko.aef.AnarchyExploitFixes;
import me.xginko.aef.utils.LocaleUtil;
import org.bukkit.ChatColor;

import java.io.File;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.Locale;
import java.util.stream.Collectors;

public class Translation {

    private final ConfigFile translationFile;

    public final String no_permission, invalid_syntax, failed_argument_parse, chat_CommandWhitelist_BadCommand,
            misc_joinMessage, misc_leaveMessage, misc_MaskedKickMessage, withers_SpawningDisabledInRadius,
            misc_enabledConnectionMsgs, misc_disabledConnectionMsgs, elytra_disablePacketElytraFly,
            elytra_global_YouAreFlyingIn, elytra_global_New, elytra_global_New_Color, elytra_global_Old,
            elytra_global_Old_Color, elytra_global_Speed, elytra_global_DisabledLowTPS, elytra_global_TooFastLowTPS,
            elytra_global_TooFastChunkInfo, elytra_global_TooFast, elytra_global_DisabledHere, elytra_global_Chunks,
            elytra_ceiling_DisabledHere, elytra_ceiling_Chunks, elytra_ceiling_YouAreFlyingIn, elytra_ceiling_New,
            elytra_ceiling_New_Color, elytra_ceiling_Old, elytra_ceiling_Old_Color, elytra_ceiling_Speed,
            elytra_ceiling_DisabledLowTPS, elytra_ceiling_TooFastLowTPS, elytra_ceiling_TooFastChunkInfo,
            elytra_ceiling_TooFast, elytra_spawn_DisabledHere, elytra_spawn_YouAreFlyingIn, elytra_spawn_New,
            elytra_spawn_New_Color, elytra_spawn_Old, elytra_spawn_Old_Color, elytra_spawn_Speed,
            elytra_spawn_DisabledLowTPS, elytra_spawn_TooFast, elytra_spawn_TooFastChunkInfo, elytra_spawn_Chunks,
            lagpreventions_stopSpammingLevers, mapspam_youCanOnlyCreateXMoreMaps, mapspam_exceededLimit, elytra_disable_timer;
    public final List<String> misc_firstJoinMessage, help_message;

    public Translation(Locale locale) throws Exception {
        AnarchyExploitFixes plugin = AnarchyExploitFixes.getInstance();
        String langFileName = LocaleUtil.languageTagForLocale(locale) + ".yml";
        File langYML = new File(plugin.getDataFolder() + "/lang", langFileName);
        // Check if the file already exists and save the one from the plugin's resources folder if it does not
        if (!langYML.exists()) plugin.saveResource("lang/" + langFileName, false);
        // Finally, load the lang file with configmaster
        this.translationFile = ConfigFile.loadConfig(langYML);

        // Commands
        this.no_permission = getTranslation("commands.no-permission",
                "&cYou don't have permission to use this command.");
        this.invalid_syntax = getTranslation("commands.invalid-syntax",
                "&cInvalid command syntax. Correct syntax: &7%syntax%");
        this.failed_argument_parse = getTranslation("commands.failed-argument-parse",
                "&cFailed to parse command arguments.");
        this.help_message = getListTranslation("commands.help-command", Arrays.asList(
                "&3----------------------------------------------------",
                "&7/toggleconnectionmsgs &8- &7Turns off join messages",
                "&7/toggledeathmsgs &8- &7Turns off death messages",
                "&7/toggletells &8- &7Turns off private messages",
                "&7/togglechat &8- &7Turns off chat messages",
                "&7/ignore &8- &7Ignore certain players",
                "&7/seed &8- &7Shows the server seed",
                "&7/kill &8- &7Kills you",
                "&7/reply &8- &7Reply to messages",
                "&7/msg &8- &7Message other players",
                "&7/stats &8- &7Shows world statistics",
                "<&3----------------------------------------------------"
        ));
        // Chat
        this.chat_CommandWhitelist_BadCommand = getTranslation("command-whitelist.bad-command",
                "&4Bad command. Type /help for a list of commands.");
        // Misc
        this.misc_joinMessage = getTranslation("join-leave-messages.join",
                "&7%player% joined the game.");
        this.misc_leaveMessage = getTranslation("join-leave-messages.leave",
                "&7%player% left the game.");
        this.misc_enabledConnectionMsgs = getTranslation("join-leave-messages.enabled-connection-msgs",
                "&7Enabled connection msgs");
        this.misc_disabledConnectionMsgs = getTranslation("join-leave-messages.disabled-connection-msgs",
                "&7Disabled connection msgs");
        this.misc_firstJoinMessage = getListTranslation("join-leave-messages.first-join",
                Collections.singletonList("&6%player% joined the game for the first time. They are %players_num% to join."));
        this.misc_MaskedKickMessage = getTranslation("kicks.masked-kick-message",
                "&6Disconnected");
        // Withers
        this.withers_SpawningDisabledInRadius = getTranslation("withers.disabled-at-spawn",
                "&4Wither spawning is disabled in a radius of %radius% blocks around spawn.");
        // Preventions
        this.lagpreventions_stopSpammingLevers = getTranslation("redstone.stop-spamming-levers",
                "&cStop spamming levers.");
        this.mapspam_youCanOnlyCreateXMoreMaps = getTranslation("map-spam.you-can-only-create-x-more-maps",
                "&eDue to the limitations of the game, you will only be able to create %amount% more maps for the next %time%");
        this.mapspam_exceededLimit = getTranslation("map-spam.exceeded-map-creation-limit",
                "&cYou exceeded the map creation limit. Please wait %time%.");
        /*
            Elytra
        */
        // Packet ElytraFly message
        this.elytra_disablePacketElytraFly = getTranslation("elytra.disable-packet-elytrafly",
                "&cDisable Packet Elytra Fly.");
        // Timer ElytraFly message
        this.elytra_disable_timer = getTranslation("elytra.disable-timer",
                "&cDisable Timer when traveling with an elytra.");
        // Global
        this.elytra_global_DisabledHere = getTranslation("elytra.elytra-speed.global.disabled-here",
                "&cElytras are currently disabled.");
        this.elytra_global_YouAreFlyingIn = getTranslation("elytra.elytra-speed.global.you-are-flying-in",
                "&7You are flying in %neworold% &7%chunks%");
        this.elytra_global_New = getTranslation("elytra.elytra-speed.global.new",
                "new");
        this.elytra_global_New_Color = getTranslation("elytra.elytra-speed.global.color-newchunks",
                "&4");
        this.elytra_global_Old = getTranslation("elytra.elytra-speed.global.old",
                "old");
        this.elytra_global_Old_Color = getTranslation("elytra.elytra-speed.global.color-oldchunks",
                "&a");
        this.elytra_global_Speed = getTranslation("elytra.elytra-speed.global.speed",
                "&7Speed: %speed% / %maxspeed%");
        this.elytra_global_DisabledLowTPS = getTranslation("elytra.elytra-speed.global.disabled-low-tps",
                "&cElytras are currently disabled because the tps is lower than %tps%.");
        this.elytra_global_TooFastLowTPS = getTranslation("elytra.elytra-speed.global.going-too-fast-low-tps",
                "&cElytra speed is reduced during low tps. Turn down your settings.");
        this.elytra_global_TooFastChunkInfo = getTranslation("elytra.elytra-speed.global.going-too-fast-chunkinfo",
                "&cTurn down your settings. Elytra speed is restricted in %neworold% %chunks%");
        this.elytra_global_TooFast = getTranslation("elytra.elytra-speed.global.going-too-fast",
                "&cTurn down your settings. Elytra speed is restricted on this server.");
        this.elytra_global_Chunks = getTranslation("elytra.elytra-speed.global.chunks",
                "chunks");
        // Nether Ceiling
        this.elytra_ceiling_DisabledHere = getTranslation("elytra.elytra-speed.nether-ceiling.disabled-here",
                "&cElytras are disabled on the nether ceiling.");
        this.elytra_ceiling_YouAreFlyingIn = getTranslation("elytra.elytra-speed.nether-ceiling.you-are-flying-in",
                "&7You are flying in %neworold% &7%chunks%");
        this.elytra_ceiling_New = getTranslation("elytra.elytra-speed.nether-ceiling.new",
                "new");
        this.elytra_ceiling_New_Color = getTranslation("elytra.elytra-speed.nether-ceiling.color-newchunks",
                "&4");
        this.elytra_ceiling_Old = getTranslation("elytra.elytra-speed.nether-ceiling.old",
                "old");
        this.elytra_ceiling_Old_Color = getTranslation("elytra.elytra-speed.nether-ceiling.color-oldchunks",
                "&a");
        this.elytra_ceiling_Speed = getTranslation("elytra.elytra-speed.nether-ceiling.speed",
                "&7Speed: %speed% / %maxspeed%");
        this.elytra_ceiling_DisabledLowTPS = getTranslation("elytra.elytra-speed.nether-ceiling.disabled-low-tps",
                "&cElytras are currently disabled because the tps is lower than %tps%.");
        this.elytra_ceiling_TooFastLowTPS = getTranslation("elytra.elytra-speed.nether-ceiling.going-too-fast-low-tps",
                "&cElytra speed is reduced during low tps. Turn down your settings.");
        this.elytra_ceiling_TooFastChunkInfo = getTranslation("elytra.elytra-speed.nether-ceiling.going-too-fast-chunkinfo",
                "&cTurn down your settings. Elytra speed is restricted in %neworold% %chunks%");
        this.elytra_ceiling_TooFast = getTranslation("elytra.elytra-speed.nether-ceiling.going-too-fast",
                "&cTurn down your settings. Elytra speed is restricted on the nether ceiling.");
        this.elytra_ceiling_Chunks = getTranslation("elytra.elytra-speed.nether-ceiling.chunks",
                "ceiling chunks");
        // Spawn
        this.elytra_spawn_DisabledHere = getTranslation("elytra.elytra-speed.spawn.disabled-here",
                "&cElytras are disabled in a range of &6%range% &cblocks around spawn.");
        this.elytra_spawn_YouAreFlyingIn = getTranslation("elytra.elytra-speed.spawn.you-are-flying-in",
                "&7You are flying in %neworold% &7%chunks%");
        this.elytra_spawn_New = getTranslation("elytra.elytra-speed.spawn.new",
                "new");
        this.elytra_spawn_New_Color = getTranslation("elytra.elytra-speed.spawn.color-newchunks",
                "&4");
        this.elytra_spawn_Old = getTranslation("elytra.elytra-speed.spawn.old",
                "old");
        this.elytra_spawn_Old_Color = getTranslation("elytra.elytra-speed.spawn.color-oldchunks",
                "&a");
        this.elytra_spawn_Speed = getTranslation("elytra.elytra-speed.spawn.speed",
                "&7Speed: %speed% / %maxspeed%");
        this.elytra_spawn_DisabledLowTPS = getTranslation("elytra.elytra-speed.spawn.disabled-low-tps",
                "&cElytras are currently disabled because the tps is lower than %tps%.");
        this.elytra_spawn_TooFastChunkInfo = getTranslation("elytra.elytra-speed.spawn.going-too-fast-chunkinfo",
                "&cElytra speed is restricted in %neworold% %chunks% in a radius of %radius% blocks.");
        this.elytra_spawn_TooFast = getTranslation("elytra.elytra-speed.nether-ceiling.going-too-fast",
                "&cElytra speed is restricted in a radius of %radius% blocks around spawn.");
        this.elytra_spawn_Chunks = getTranslation("elytra.elytra-speed.spawn.chunks",
                "spawn chunks");

        try {
            translationFile.save();
        } catch (Exception e) {
            AnarchyExploitFixes.prefixedLogger().trace("Failed to save language file: {}", langYML.getName(), e);
        }
    }

    private String getTranslation(String path, String defaultTranslation) {
        translationFile.addDefault(path, defaultTranslation);
        return ChatColor.translateAlternateColorCodes('&', translationFile.getString(path, defaultTranslation));
    }

    private String getTranslation(String path, String defaultTranslation, String comment) {
        translationFile.addDefault(path, defaultTranslation, comment);
        return ChatColor.translateAlternateColorCodes('&', translationFile.getString(path, defaultTranslation));
    }

    private List<String> getListTranslation(String path, List<String> defaultTranslation) {
        translationFile.addDefault(path, defaultTranslation);
        return translationFile.getStringList(path)
                .stream()
                .map(line -> ChatColor.translateAlternateColorCodes('&', line))
                .collect(Collectors.toList());
    }

    private List<String> getListTranslation(String path, List<String> defaultTranslation, String comment) {
        translationFile.addDefault(path, defaultTranslation, comment);
        return translationFile.getStringList(path)
                .stream()
                .map(line -> ChatColor.translateAlternateColorCodes('&', line))
                .collect(Collectors.toList());
    }
}